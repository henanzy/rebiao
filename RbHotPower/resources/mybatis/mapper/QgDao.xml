<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "http://mybatis.org/dtd/mybatis-3-mapper.dtd" "mybatis-3-mapper.dtd" >
<mapper namespace="com.hnzy.rb.dao.QgDao">
<resultMap type="Qg" id="qg">
		<id property="id" column="ID" />
		<result property="qgID" column="QgID" />
		<result property="jzqID" column="JzqID" />
		<result property="xqName" column="XqName" />
		<result property="qgStatus" column="QgStatus" />
		<result property="version" column="Version" />
		<result property="mode" column="Mode" />
		<result property="readCycle" column="ReadCycle" />
		<result property="vALstID" column="VALstID" />
		<result property="vALedID" column="VALedID" />
		<result property="installAd" column="InstallAd" />
		<result property="recordTime" column="RecordTime" />
		<result property="qgFl" column="QgFl"/>
		<result property="fmCou" column="FmCou"/>
		<result property="skqSbh" column="SkqSbh"/>
		<association property="jzq" javaType="com.hnzy.rb.pojo.Jzq">
		<id property="id" column="ID"/>
		<result property="jzqId" column="JzqId"/>
		<result property="jzqPort" column="JzqPort"/>
		<result property="jzqIp" column="JzqIP"/>
		<result property="jzqxt" column="jzqxt" />
		<result property="hesName" column="HESName" />
		<result property="updateTime" column="UpdateTime" />
		</association>
	</resultMap>
	<select id="findQg" resultMap="qg">
		select qg.QgID,qg.JzqID,qg.XqName,qg.InstallAd,qg.RecordTime,jzq.jzqxt,qg.QgFl 
		from T_QgInfo qg,T_JzqInfo jzq where qg.JzqID=jzq.JzqID and ( QgFl=1  or QgFl=2) order by qg.xqName
	</select>
	<select id="findQgID" resultMap="qg" parameterType="Qg">
	select distinct JzqIP,JzqPort,jzqxt,qg.XqName,HESName,qg.JzqID from T_QgInfo  qg,T_JzqInfo jzq where qg.JzqID=jzq.JzqID and qg.QgID=#{qgId}
	</select>
	<select id="findJzq" resultMap="qg" >
	select distinct qg.QgID,jzq.JzqID,jzq.JzqIP,jzq.JzqPort,jzq.Socket,jzq.UpdateTime,jzq.HESName,jzq.jzqxt,jzq.XqName 
	from T_QgInfo qg,T_JzqInfo jzq where qg.JzqID=jzq.JzqID  and (qg.QgFl=1 or qg.QgFl=2)
	</select>
	<!-- socket根据区管ID更新集中器IP和端口号 -->
	<update id="updateQgIP" parameterType="Qg">
	update T_JzqInfo set JzqIP=#{Ip},JzqPort=#{port},UpdateTime=#{recordTime} where JzqId=#{jzqId}
	</update>
	<!-- socket根据区管ID更新区管状态 -->
	<update id="updateQgSta" parameterType="Qg">
	update T_QgInfo set RecordTime=#{recordTime},QgStatus=1 where QgID=#{qgId}
	</update>

</mapper>
